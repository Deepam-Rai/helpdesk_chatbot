version: "3.1"

entities:
  - PERSON
  - email
  - otp

intents:
  - login
  - provide_otp

slots:
  logged_in:
    type: bool
    influence_conversation: true
    initial_value: false
    mappings:
      - type: custom

  user_name:
    type: text
    influence_conversation: false
    mappings:
      - type: from_entity
        entity: PERSON
        conditions:
          - active_loop: login_form

  user_email:
    type: text
    influence_conversation: false
    mappings:
      - type: from_entity
        entity: email
        conditions:
          - active_loop: login_form

  sent_login_otp:
    type: text
    influence_conversation: false
    mappings:
      - type: custom

  login_otp:
    type: text
    influence_conversation: false
    mappings:
      - type: from_entity
        entity: otp
        conditions:
          - active_loop: login_form
            requested_slot: otp

forms:
  login_form:
    ignored_intents:
      - cancel
    required_slots:
      - user_name
      - user_email
      - login_otp

actions:
  - action_start_login
  - validate_login_form
  - action_submit_login_form
  - action_ask_login_otp
